<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeVoice Feed - Anonymous Student Discussions</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <custom-navbar></custom-navbar>

    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- Feed Header -->
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">SafeVoice Feed</h1>
                <p class="text-gray-600">Real-time anonymous discussions from students worldwide</p>
            </div>
            
            <div class="flex flex-wrap gap-2" id="filter-buttons">
                <button data-filter="all" class="filter-btn bg-blue-600 text-white px-4 py-2 rounded-lg font-medium">All</button>
                <button data-filter="trending" class="filter-btn bg-white text-gray-700 px-4 py-2 rounded-lg font-medium border">Trending</button>
                <button data-filter="latest" class="filter-btn bg-white text-gray-700 px-4 py-2 rounded-lg font-medium border">Latest</button>
                <button data-filter="crisis" class="filter-btn bg-white text-gray-700 px-4 py-2 rounded-lg font-medium border">Crisis</button>
                <button data-filter="mental-health" class="filter-btn bg-white text-gray-700 px-4 py-2 rounded-lg font-medium border">Mental Health</button>
                <button data-filter="memorial" class="filter-btn bg-white text-gray-700 px-4 py-2 rounded-lg font-medium border">Memorials</button>
            </div>
        </div>

        <!-- NEW: Search Bar -->
        <div class="mb-8 max-w-xl">
            <div class="relative">
                <input 
                    type="text" 
                    id="feedSearchInput"
                    placeholder="Search posts by keyword..." 
                    class="w-full p-4 pl-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                <i data-feather="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
            </div>
        </div>

        <!-- Main Feed Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Posts Column -->
            <div class="lg:col-span-2 space-y-6" id="posts-container">
                
                <!-- NEW: Added data-topic and data-content attributes -->
                <div class="post-card bg-white rounded-2xl shadow-lg p-6 fade-in" data-topic="crisis" data-content="the pressure of finals is overwhelming feeling completely burned out with finals approaching. the constant studying, pressure to perform, and lack of sleep is taking a toll on my mental health. anyone else struggling with this?">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">
                            <i data-feather="user" class="text-white w-5 h-5"></i>
                        </div>
                        <div class="text-sm text-gray-500">BraveOwl123 • 2 hours ago • University of California</div>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">The pressure of finals is overwhelming</h3>
                    <p class="text-gray-600 mb-4 leading-relaxed">
                    Feeling completely burned out with finals approaching. The constant studying, pressure to perform, and lack of sleep is taking a toll on my mental health. Anyone else struggling with this?</p>
                    
                    <!-- NEW: Example of a post with an image -->
                    <div class="my-4 rounded-lg overflow-hidden">
                        <img src="https://placehold.co/600x400/94a3b8/ffffff?text=Example+Post+Image" alt="Post Image" class="w-full h-auto object-cover cursor-pointer post-image">
                    </div>

                    <!-- Reactions -->
                    <div class="flex items-center gap-4 mb-4">
                        <!-- ... existing reaction buttons ... -->
                    </div>
                    
                    <div class="flex items-center gap-4 text-sm text-gray-500">
                        <!-- ... existing comment/share links ... -->
                    </div>
                </div>

                <!-- NEW: Added data-topic and data-content attributes -->
                <div class="post-card bg-white rounded-2xl shadow-lg p-6 fade-in" data-topic="mental-health" data-content="found this amazing meditation technique that helped my anxiety after struggling with panic attacks during exams, i discovered a simple breathing exercise that changed everything. want to share it with anyone who might benefit.">
                    <div class="flex items-center gap-3 mb-4">
                        <!-- ... existing card content ... -->
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">Found this amazing meditation technique that helped my anxiety</h3>
                    <p class="text-gray-600 mb-4 leading-relaxed">
                    After struggling with panic attacks during exams, I discovered a simple breathing exercise that changed everything. Want to share it with anyone who might benefit.</p>
                    
                    <!-- Reactions -->
                    <!-- ... existing card content ... -->
                </div>

                <!-- NEW: Added data-topic and data-content attributes -->
                <div class="post-card bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl shadow-lg p-6 fade-in" data-topic="memorial" data-content="remembering sarah - a light that burned too bright today marks one year since we lost our dear friend sarah to depression. she was brilliant, kind, and always there for others. let's honor her memory by being there for each other.">
                    <div class="flex items-center gap-3 mb-4">
                        <!-- ... existing card content ... -->
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">Remembering Sarah - A light that burned too bright</h3>
                    <p class="text-gray-600 mb-4 leading-relaxed">
                    Today marks one year since we lost our dear friend Sarah to depression. She was brilliant, kind, and always there for others. Let's honor her memory by being there for each other.</p>
                    
                    <!-- Memorial Reactions -->
                    <!-- ... existing card content ... -->
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- ... existing sidebar content ... -->
            </div>
        </div>
    </main>

    <!-- NEW: Image Modal -->
    <div id="imageModal" class="image-modal">
        <button id="imageModalClose" class="image-modal-close">
            <i data-feather="x" class="w-8 h-8"></i>
        </button>
        <div class="image-modal-content">
            <img id="modalImage" src="" alt="Full-screen post image">
        </div>
    </div>

    <custom-footer></custom-footer>

    <script src="./navbar.js"></script>
    <script src="./footer.js"></script>
    <script src="./script.js"></script>
    <script>
        feather.replace();

        // --- NEW SCRIPT ---
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Fix Token Balance Display
            setTimeout(() => {
                const tokenEl = document.getElementById('tokenBalanceDisplay');
                if (tokenEl && window.safeVoiceApp) {
                    tokenEl.textContent = window.safeVoiceApp.tokenBalance.toLocaleString();
                }
            }, 500);

            const postsContainer = document.getElementById('posts-container');
            const allPosts = postsContainer.querySelectorAll('.post-card');

            // 2. Implement Client-Side Topic Filtering
            const filterButtons = document.querySelectorAll('#filter-buttons .filter-btn');
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const filter = button.dataset.filter;
                    document.getElementById('feedSearchInput').value = ''; // Clear search
                    filterPosts(filter);
                });
            });

            // 3. Implement Client-Side Search
            const searchInput = document.getElementById('feedSearchInput');
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                // Deactivate topic filters when searching
                filterButtons.forEach(btn => {
                    btn.classList.remove('bg-blue-600', 'text-white');
                    btn.classList.add('bg-white', 'text-gray-700', 'border');
                });
                filterButtons[0].classList.add('bg-blue-600', 'text-white'); // Set 'All' to active
                
                filterPosts('all', query);
            });

            function filterPosts(filter, query = '') {
                allPosts.forEach(post => {
                    const topicMatch = (filter === 'all' || post.dataset.topic === filter);
                    const queryMatch = (query === '' || post.dataset.content.includes(query));

                    if (topicMatch && queryMatch) {
                        post.style.display = 'block';
                    } else {
                        post.style.display = 'none';
                    }
                });
            }

            // 4. Image Modal Logic
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const closeModal = document.getElementById('imageModalClose');

            postsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('post-image')) {
                    modalImg.src = e.target.src;
                    modal.classList.add('show');
                }
            });

            closeModal.addEventListener('click', () => {
                modal.classList.remove('show');
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('show');
                }
            });
        });
        // --- END NEW SCRIPT ---
    </script>
</body>
</html>

